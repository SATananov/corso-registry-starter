<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Моят профил</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="topbar">
  <div class="brand"><a href="index.html"><strong>Listings Starter</strong></a></div>
  <nav class="nav">
    <a href="index.html">Начало</a>
    <a data-if-authed href="#" data-logout>Изход</a>
    <a data-if-anon href="login.html" class="btn">Вход</a>
  </nav>
</header>

<main class="container">
  <section class="card">
    <h1>Моят профил</h1>
    <div id="whoami" class="muted">Зареждам…</div>
  </section>
</main>

<script type="module">
  import { bootstrap, requireAuth } from './js/app.js';
  import { supabase } from './js/api.js';

  bootstrap();
  await requireAuth('login.html');

  // покажи текущия потребител
  const { data } = await supabase.auth.getSession();
  const user = data.session?.user;
  const who = document.getElementById('whoami');

  // дръпни профила (username, role)
  const { data: prof } = await supabase
    .from('profiles')
    .select('username, display_name, role, email')
    .eq('id', user.id)
    .maybeSingle();

  who.innerHTML = `
    <div><strong>Име:</strong> ${prof?.display_name || '—'}</div>
    <div><strong>Потребителско име:</strong> ${prof?.username || '—'}</div>
    <div><strong>Email:</strong> ${prof?.email || user.email || '—'}</div>
    <div><strong>Роля:</strong> ${prof?.role || 'user'}</div>
  `;
</script>
</body>
</html>
